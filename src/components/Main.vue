<template>
  <div class="main">
    <div class="top-bar">
      <div class="site-avatar">
        <svg id="font-vdata-cu" viewBox="0 0 208 42" width="120px">
          <title>videodata-cuti</title>
          <path fill="#fff" d="M11.020 31.47l-11.020-31.47h4.45l9.007 27.232h0.106l9.113-27.232h4.344l-11.232 31.47h-4.768z"></path>
          <path fill="#fff" d="M29.139 4.556v-4.556h3.709v4.556h-3.709zM32.954 8.689v22.781h-3.709v-22.781h3.709z"></path>
          <path fill="#fff" d="M55.311 31.47v-3.073h-0.106c-0.636 1.272-1.589 2.225-2.861 2.755s-2.755 0.848-4.344 0.848c-1.801 0-3.285-0.318-4.556-0.954s-2.437-1.483-3.285-2.649c-0.848-1.060-1.483-2.331-2.013-3.815-0.424-1.483-0.636-2.967-0.636-4.556s0.212-3.179 0.636-4.556 1.060-2.649 1.907-3.815c0.848-1.060 1.907-1.907 3.285-2.543 1.272-0.636 2.861-0.954 4.556-0.954 0.636 0 1.166 0.106 1.907 0.212 0.636 0.106 1.377 0.318 2.013 0.636s1.272 0.636 1.907 1.060c0.636 0.424 1.060 1.060 1.483 1.695h0.106v-11.762h3.709v31.47h-3.709zM41.854 23.417c0.318 1.060 0.742 1.907 1.272 2.755 0.53 0.742 1.272 1.377 2.225 1.907 0.848 0.424 1.907 0.742 3.179 0.742s2.331-0.212 3.179-0.742c0.848-0.53 1.589-1.166 2.119-2.013s0.954-1.695 1.166-2.755c0.212-1.060 0.424-2.119 0.424-3.179 0-1.166-0.106-2.225-0.424-3.285-0.212-1.060-0.636-1.907-1.272-2.755-0.53-0.742-1.272-1.483-2.225-1.907-0.954-0.53-2.013-0.742-3.285-0.742s-2.331 0.212-3.179 0.742c-0.848 0.53-1.589 1.166-2.119 2.013s-0.954 1.801-1.166 2.861c-0.212 1.060-0.318 2.119-0.318 3.285 0 0.954 0.212 2.013 0.424 3.073z"></path>
          <path fill="#fff" d="M80.954 29.987c-1.695 1.272-3.815 1.907-6.464 1.907-1.801 0-3.391-0.318-4.768-0.848-1.377-0.636-2.437-1.377-3.391-2.437s-1.589-2.331-2.013-3.815c-0.424-1.483-0.742-3.073-0.742-4.768s0.212-3.285 0.742-4.768c0.53-1.483 1.272-2.649 2.225-3.709s2.119-1.907 3.391-2.437c1.272-0.636 2.755-0.848 4.344-0.848 2.013 0 3.709 0.424 5.086 1.272s2.437 1.907 3.179 3.179c0.848 1.272 1.377 2.649 1.695 4.238 0.318 1.483 0.424 2.967 0.424 4.344h-17.060c0 0.954 0.106 1.907 0.318 2.861 0.212 0.848 0.742 1.695 1.272 2.331 0.636 0.742 1.377 1.272 2.225 1.695 0.954 0.424 2.013 0.636 3.179 0.636 1.589 0 2.861-0.318 3.921-1.060s1.695-1.801 2.013-3.391h3.709c-0.424 2.437-1.589 4.344-3.285 5.616zM80.106 15.364c-0.318-0.742-0.742-1.483-1.377-2.013-0.53-0.53-1.272-1.060-2.013-1.377s-1.589-0.53-2.543-0.53c-0.954 0-1.801 0.212-2.649 0.53-0.742 0.318-1.483 0.848-2.013 1.377-0.53 0.636-0.954 1.272-1.272 2.013s-0.53 1.589-0.53 2.437h13.033c-0.106-0.848-0.318-1.589-0.636-2.437z"></path>
          <path fill="#fff" d="M87.947 15.364c0.424-1.483 1.166-2.755 2.119-3.815s2.119-1.907 3.497-2.543c1.377-0.636 2.967-0.954 4.768-0.954s3.391 0.318 4.768 0.954c1.377 0.636 2.543 1.483 3.497 2.543s1.695 2.331 2.119 3.815c0.424 1.483 0.742 2.967 0.742 4.662s-0.212 3.179-0.742 4.662c-0.424 1.483-1.166 2.649-2.119 3.815-0.954 1.060-2.119 1.907-3.497 2.543s-2.967 0.954-4.768 0.954c-1.801 0-3.391-0.318-4.768-0.954s-2.543-1.483-3.497-2.543c-0.954-1.060-1.695-2.331-2.119-3.815s-0.742-2.967-0.742-4.662 0.318-3.179 0.742-4.662zM91.762 23.735c0.318 1.060 0.848 2.013 1.483 2.649 0.636 0.742 1.377 1.272 2.225 1.695s1.801 0.53 2.755 0.53c0.954 0 1.907-0.212 2.755-0.53 0.848-0.424 1.589-0.954 2.225-1.695s1.166-1.589 1.483-2.649c0.318-1.060 0.53-2.331 0.53-3.709s-0.212-2.649-0.53-3.709c-0.318-1.060-0.848-2.013-1.483-2.755s-1.377-1.272-2.225-1.695c-0.848-0.424-1.801-0.53-2.755-0.53s-1.907 0.212-2.755 0.53c-0.848 0.424-1.589 0.954-2.225 1.695s-1.166 1.589-1.483 2.755c-0.318 1.060-0.53 2.331-0.53 3.709s0.212 2.649 0.53 3.709z"></path>
          <path fill="#fff" d="M127.576 0c2.013 0 3.921 0.318 5.616 0.954s3.285 1.589 4.556 2.861c1.272 1.272 2.225 2.861 2.967 4.874 0.742 1.907 1.060 4.238 1.060 6.781 0 2.331-0.318 4.45-0.848 6.358-0.636 1.907-1.483 3.603-2.649 4.98s-2.649 2.543-4.45 3.285c-1.801 0.848-3.921 1.166-6.252 1.166h-13.563v-31.258h13.563zM127.152 25.642c0.954 0 2.013-0.212 2.861-0.53 0.954-0.318 1.801-0.848 2.543-1.589s1.272-1.695 1.801-2.967c0.424-1.166 0.636-2.649 0.636-4.45 0-1.589-0.106-2.967-0.424-4.344-0.318-1.272-0.848-2.331-1.483-3.285-0.742-0.954-1.589-1.589-2.755-2.119s-2.543-0.742-4.344-0.742h-4.98v19.815h6.146z"></path>
          <path fill="#fff" d="M145.695 15.682c0.106-1.483 0.424-2.649 1.060-3.709 0.636-0.954 1.483-1.695 2.437-2.331s2.119-0.954 3.391-1.272c1.272-0.212 2.543-0.424 3.815-0.424 1.166 0 2.331 0.106 3.497 0.212 1.166 0.212 2.225 0.53 3.179 0.954s1.801 1.166 2.331 1.907 0.954 1.907 0.954 3.285v11.868c0 1.060 0.106 2.013 0.212 2.967s0.318 1.695 0.636 2.119h-6.358c-0.106-0.318-0.212-0.742-0.318-1.060s-0.106-0.742-0.106-1.166c-0.954 1.060-2.225 1.695-3.497 2.119-1.377 0.424-2.755 0.636-4.132 0.636-1.060 0-2.119-0.106-3.073-0.424-0.954-0.212-1.801-0.636-2.437-1.272-0.742-0.53-1.272-1.272-1.695-2.119s-0.636-1.907-0.636-3.073c0-1.272 0.212-2.331 0.636-3.179s1.060-1.483 1.801-2.013c0.742-0.53 1.589-0.848 2.437-1.166 0.954-0.212 1.907-0.424 2.755-0.636 0.954-0.106 1.907-0.212 2.755-0.318 0.954-0.106 1.695-0.212 2.437-0.424s1.272-0.424 1.695-0.742 0.636-0.848 0.53-1.483c0-0.636-0.106-1.166-0.318-1.589s-0.53-0.742-0.848-0.954-0.742-0.318-1.272-0.424c-0.53-0.106-0.954-0.106-1.589-0.106-1.272 0-2.225 0.212-2.861 0.742-0.742 0.53-1.166 1.377-1.272 2.649h-6.146zM160.212 20.344c-0.212 0.212-0.636 0.424-0.954 0.53-0.424 0.106-0.848 0.212-1.272 0.318s-0.954 0.212-1.483 0.212c-0.53 0.106-0.954 0.106-1.483 0.212-0.424 0.106-0.954 0.212-1.377 0.318s-0.848 0.318-1.166 0.636c-0.318 0.212-0.636 0.53-0.848 0.954s-0.318 0.848-0.318 1.483c0 0.53 0.106 1.060 0.318 1.377 0.212 0.424 0.53 0.636 0.848 0.954s0.742 0.424 1.272 0.424 0.954 0.106 1.483 0.106c1.272 0 2.225-0.212 2.861-0.636s1.166-0.954 1.483-1.483c0.318-0.53 0.53-1.166 0.636-1.695 0.106-0.636 0.106-1.060 0.106-1.377v-2.331z"></path>
          <path fill="#fff" d="M183.841 8.689v4.238h-4.556v11.232c0 1.060 0.212 1.801 0.53 2.119s1.060 0.53 2.119 0.53c0.318 0 0.742 0 1.060 0s0.636-0.106 0.954-0.106v4.874c-0.53 0.106-1.166 0.106-1.801 0.212-0.636 0-1.272 0-1.907 0-0.954 0-1.907-0.106-2.755-0.212s-1.589-0.424-2.331-0.742c-0.636-0.424-1.166-0.954-1.589-1.589-0.424-0.742-0.53-1.589-0.53-2.755v-13.669h-3.815v-4.238h3.815v-6.781h6.252v6.781h4.556z"></path>
          <path fill="#fff" d="M186.49 15.682c0.106-1.483 0.424-2.649 1.060-3.709 0.636-0.954 1.483-1.695 2.437-2.331s2.119-0.954 3.391-1.272c1.272-0.212 2.543-0.424 3.815-0.424 1.166 0 2.331 0.106 3.497 0.212 1.166 0.212 2.225 0.53 3.179 0.954s1.801 1.166 2.331 1.907 0.954 1.907 0.954 3.285v11.868c0 1.060 0.106 2.013 0.212 2.967s0.318 1.695 0.636 2.119h-6.358c-0.106-0.318-0.212-0.742-0.318-1.060s-0.106-0.742-0.106-1.166c-0.954 1.060-2.225 1.695-3.497 2.119-1.377 0.424-2.755 0.636-4.132 0.636-1.060 0-2.119-0.106-3.073-0.424-0.954-0.212-1.801-0.636-2.437-1.272-0.742-0.53-1.272-1.272-1.695-2.119s-0.636-1.907-0.636-3.073c0-1.272 0.212-2.331 0.636-3.179s1.060-1.483 1.801-2.013c0.742-0.53 1.589-0.848 2.437-1.166 0.954-0.212 1.907-0.424 2.755-0.636 0.954-0.106 1.907-0.212 2.755-0.318 0.954-0.106 1.695-0.212 2.437-0.424s1.272-0.424 1.695-0.742 0.636-0.848 0.53-1.483c0-0.636-0.106-1.166-0.318-1.589s-0.53-0.742-0.848-0.954-0.742-0.318-1.272-0.424c-0.53-0.106-0.954-0.106-1.589-0.106-1.272 0-2.225 0.212-2.861 0.742-0.742 0.53-1.166 1.377-1.272 2.649h-6.146zM201.007 20.344c-0.212 0.212-0.636 0.424-0.954 0.53-0.424 0.106-0.848 0.212-1.272 0.318s-0.954 0.212-1.483 0.212c-0.53 0.106-0.954 0.106-1.483 0.212-0.424 0.106-0.954 0.212-1.377 0.318s-0.848 0.318-1.166 0.636c-0.318 0.212-0.636 0.53-0.848 0.954s-0.318 0.848-0.318 1.483c0 0.53 0.106 1.060 0.318 1.377 0.212 0.424 0.53 0.636 0.848 0.954s0.742 0.424 1.272 0.424 0.954 0.106 1.483 0.106c1.272 0 2.225-0.212 2.861-0.636s1.166-0.954 1.483-1.483c0.318-0.53 0.53-1.166 0.636-1.695 0.106-0.636 0.106-1.060 0.106-1.377v-2.331z"></path>
        </svg>
      </div>

      <div class="menu-container">
        <div class="menu-nav">
          <el-menu :default-active="activeIndex" class="el-menu-main" mode="horizontal" @select="handleSelect">
            <el-menu-item index="1" class="el-menu-btn">日志管理</el-menu-item>
            <el-submenu index="2" class="el-menu-dropdown-btn">
              <template slot="title">附加功能</template>
              <el-menu-item index="2-1" class="el-dropdown-menu-item">导出</el-menu-item>
              <el-menu-item index="2-2" class="el-dropdown-menu-item">导入</el-menu-item>
            </el-submenu>
          </el-menu>
        </div>

        <div class="menu-status">
          <div class="nav-user-box">
            <router-link :to="{ name: 'Login' }" class="vp-btn vp-btn-hollow vp-btn-blue trasparent">登录</router-link>
          </div>
        </div>
      </div>
    </div>

    <div class="body-container">
      <div class="main-content">
        <div class="search-bar-row">
          <el-form :inline="true" :model="formInline" class="search-form">
            <el-form-item label="关键字">
              <el-input v-model="formInline.user" placeholder="关键字"></el-input>
            </el-form-item>
            <el-form-item label="时间范围" required>
              <el-date-picker
                v-model="ruleForm.searchTime"
                type="datetimerange"
                :picker-options="pickerOptions2"
                placeholder="选择时间范围"
                align="right">
              </el-date-picker>
            </el-form-item>
            <el-form-item>
              <el-button class="btn-zen search-btn submit-button" type="primary" @click="onSubmit">查询</el-button>
            </el-form-item>
          </el-form>
        </div>

        <div class="content-container" v-if="!isLoadFinish">
          <span class="el-icon-information no-info-requested"> 请输入关键字或者时间范围</span>
        </div>
        <div class="el-requested-information" v-if="isLoadFinish">
          <div class="search-result-table">
            <el-table
              :data="mockData"
              border
              style="width: 100%"
              max-height="450">
              <el-table-column
                fixed
                prop="created"
                label="Date"
                width="210">
              </el-table-column>
              <el-table-column
                prop="version"
                label="Version"
                width="90">
              </el-table-column>
              <el-table-column
                prop="ip"
                label="IP Address"
                width="150">
              </el-table-column>
              <el-table-column
                prop="client"
                label="Client"
                width="220">
              </el-table-column>
              <el-table-column
                prop="ua"
                label="UA"
                width="300">
              </el-table-column>
              <el-table-column
                prop="refer"
                label="Refer"
                width="220">
              </el-table-column>
              <el-table-column
                prop="video"
                label="Video"
                width="240">
              </el-table-column>
              <el-table-column
                prop="program"
                label="Program"
                width="240">
              </el-table-column>
              <el-table-column
                prop="ad"
                label="Ad"
                width="240">
              </el-table-column>
              <el-table-column
                fixed="right"
                label="更多信息"
                width="100">
                <template>
                  <div>
                    <el-button type="text" @click="openDialog" class="el-more-info-btn" icon="information"></el-button>
                  </div>
                </template>
              </el-table-column>
            </el-table>
          </div>
          <el-pagination
            @size-change="handleSizeChange"
            @current-change="handleCurrentChange"
            :current-page.sync="currentPage3"
            :page-size="100"
            layout="prev, pager, next, jumper"
            class="el-info-pagination"
            :total="1000">
          </el-pagination>
        </div>
      </div>
    </div>
    <el-dialog class="dialog-table" :visible.sync="dialogTableVisible" :title="dialogData.title">
      <el-table :data="dialogData">
        <el-table-column property="info" label="Info" width="150"></el-table-column>
        <el-table-column property="description" label="Description"></el-table-column>
      </el-table>
    </el-dialog>
  </div>
</template>

<script>
import axios from 'axios'
export default {

  data () {
    return {
      isLoadFinish: false,
      mockData: [],
      dialogData: [],
      activeIndex: '0',
      formInline: {
        user: '',
        region: ''
      },
      ruleForm: {
        name: '',
        region: '',
        searchTime: '',
        date2: '',
        delivery: false,
        type: [],
        resource: '',
        desc: ''
      },
      dialogTableVisible: false,
      pickerOptions2: {
        shortcuts: [{
          text: '最近一周',
          onClick (picker) {
            const end = new Date()
            const start = new Date()
            start.setTime(start.getTime() - 3600 * 1000 * 24 * 7)
            picker.$emit('pick', [start, end])
          }
        }, {
          text: '最近一个月',
          onClick (picker) {
            const end = new Date()
            const start = new Date()
            start.setTime(start.getTime() - 3600 * 1000 * 24 * 30)
            picker.$emit('pick', [start, end])
          }
        }, {
          text: '最近三个月',
          onClick (picker) {
            const end = new Date()
            const start = new Date()
            start.setTime(start.getTime() - 3600 * 1000 * 24 * 90)
            picker.$emit('pick', [start, end])
          }
        }]
      }
    }
  },
  methods: {
    openDialog () {
      this.dialogTableVisible = true
      console.log('DIALOG', this.ruleForm.searchTime)
      const dialogDataObj = this.mockData[0]
      const dialogDataArr = []
      for (var key in dialogDataObj) { dialogDataArr.push({ info: key, description: dialogDataObj[key] }) }
      this.dialogData = dialogDataArr
      console.log(dialogDataArr)
    },
    handleSelect (key, keyPath) {
      console.log(key, keyPath)
    },
    onSubmit () {
      const from = this.ruleForm.searchTime[0].getTime() / 1000
      const to = this.ruleForm.searchTime[1].getTime() / 1000
      console.log('The time is from ' + from + ' to ' + to + this.mockData)
      const self = this
      requestData(from, to, function (response) {
        self.mockData = response.data.data.logs
        self.isLoadFinish = true
        console.log(response.data.data.logs, response.data.data.count)
      }, function(message) {})
      console.log('submit!', this.ruleForm.searchTime)
    }

  }

}
function requestData (start, to, onSuccess, onFail) {
  axios.get('/api/log/get_logs.json', {
    params: {
      from: start,
      to: to
    }
  }).then((response) => {
    typeof onSuccess === 'function' && onSuccess(response)
    console.log(response)
  }).catch((error) => {
    typeof onFail === 'function' && onFail('请求失败')
    console.log(error)
  })
}
</script>

<!-- Add "scoped" attribute to limit CSS to this component only -->
<style scoped>
.main {
  padding: 20px;
  max-width: 912px;
  margin: auto;
}

/* @import url('https://fonts.googleapis.com/css?family=Roboto:400,500'); */

@media (min-width: 768px) {
  .main {
    padding: auto;
    margin: auto;
  }
}

.top-bar {
  /*text-align: left;
  height: 60px;
  line-height: 60px;
  */
  display: flex;
  width: 100%;
  height: 100%;
  -ms-flex-pack: justify;
  justify-content: space-between;
  -ms-flex-align: center;
  align-items: center;
  transition: all .3s;
}
.menu-container {
  display: flex;
  -ms-flex-pack: justify;
  justify-content: space-between;
  -ms-flex-align: center;
  align-items: center;
}
.site-avatar {
  padding: 10px 16px;
  height: 32px;
  background: #343434;
}
.site-avatar>svg {
  margin-top: 8px;
}
.menu-nav {
  display: inline-block;
}
.menu-status {
}
.nav-user-box{

}
.body-container {
  margin-top: 12px;
  background-color: #fff;
  border: 1px solid #edf0f2;
  border-radius: 2px;
  -webkit-box-shadow: 0 2px 6px rgba(0,0,0,0.07);
  box-shadow: 0 2px 6px rgba(0,0,0,0.07);
}

.main-content {
  min-height: 1020px;
  background-color: transparent;
}

.search-bar-row {
  padding: 16px;
}

.content-container {
  background: black;
  width:95%;
  min-height: 200px;
  margin: 2.5%;
  -webkit-border-radius: 30px;
  -moz-border-radius: 30px;
  border-radius: 30px;
  color: white;
  line-height: 200px;
  text-align: center;
  font-size: 20px;
  padding-bottom: 20px;
  padding-top: 20px;
}

.el-menu-btn:hover {
  border-bottom: 5px black solid;
  transition: all 0s;
}

.el-dropdown-menu-item:hover {
  background-color: black;
  color: white;
  transition: .3s;
  box-shadow: 1px 0 1px #676767;
}

.el-dropdown-menu-item:active {
  background: #efefef;
  border-right: 2px #efefef solid;
  box-shadow: 0 0 0 #000000;
  transition: all 0s;
}

.el-menu-dropdown-btn:hover {
  height: 55px;
  border-bottom: 5px solid black;
  transition: .3s opacity;
}

.el-menu-dropdown-btn:active {
  height: 55px;
  border-bottom: 5px solid black;
}

.no-info-requested{
  border: white 2px solid;
  padding: 8% 30%;
  margin: 0 4%;
  border-radius: 20px;
}

.submit-button:active {
  background-color: #f7f9fa;
}

/*requested Information CSS*/

.search-result-table {
  margin: 0 2.5%;
  font-family: Roboto;
}

.el-more-info-btn {
  color: #3574e4;
  background-color: white;
  border: 1px #3574e4 solid;
  padding: 7px 15px 5px 15px;
  margin-left: 8px;
}

.el-more-info-btn:hover {
  color: white;
  background-color: #3574e4;
  -webkit-transition: all .3s;
  -moz-transition: all .3s;
  -ms-transition: all .3s;
  -o-transition: all .3s;
  transition: all .3s;
}

.el-more-info-btn:active {
  color: #ffffff;
  background-color: #43ddff;
  border: 1px #43ddff solid;
}

.dialog-table{
  font-family: Roboto;
}

.el-info-pagination {
  margin: 0 2.5%;
  padding: 10px 0;
}

.search-form .el-input__inner {
  color: #76858c;
  border: 1px solid #edf0f2;
  border-radius: 3px;
}
</style>
